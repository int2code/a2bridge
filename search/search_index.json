{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#device-overview","title":"Device overview","text":"<p>The A2Bridge is used to stream multichannel audio data via USB to or from A2B bus.  It can be configured to be used either as an A2B master or slave. A2Bridge is a tool which might be used by developers and testers to develop their A2B devices like amplifiers or microphones. </p> <p></p>"},{"location":"#capabilities","title":"Capabilities","text":"<ol> <li> <p>A2B Master device -  The device supports an A2B master mode with a user-defined bus topology. It enables bidirectional communication across up to 32 audio channels, allowing seamless data exchange between USB and A2B interfaces.</p> </li> <li> <p>A2B Slave device -  A2Bridge can be used in test environments where it is necessary to simulate an A2B sub-node.</p> </li> <li> <p>Control A2B transceivers and nodes with your PC - With A2Bridge, users can develop and execute custom desktop-based test applications to configure the A2B transceiver and associated I\u00b2C peripherals. We provide a lightweight Python API that enables I\u00b2C-over-distance communication, allowing users to read from and write to peripheral I\u00b2C registers with ease.</p> </li> <li> <p>Support mailboxes -  Developers can test device communication with the head unit using our A2B mailbox, with support provided through Python and Protobuf.</p> </li> </ol>"},{"location":"#hardware-description","title":"Hardware description","text":"<p>The A2Bridge has: - two USB-C ports,  - four status LEDs,  - and two A2B ports</p>"},{"location":"#device-status","title":"Device status","text":"<p>There are 4 LEDs which signalize the current status of device.</p>"},{"location":"#led-1-a2bridge-status","title":"LED 1 - A2Bridge Status","text":"<p><p>LED_1 </p></p> status LED color Description <code>ERROR</code> RED Device is in runtime unrecoverable error (ie. unexpected node drop).  Audio output is fully muted in that state. <code>IMPAIRED</code> YELLOW Device is in an impaired state (ie. not all configured slaves were discovered).  State can be recovered ie. by doing rediscovery of the bus via console.    Audio output is fully muted in that state. <code>NORMAL</code> GREEN The device is fully operational. The audio will be streamed between USB and A2B."},{"location":"#led-2-not-used","title":"LED 2 not used","text":"<p>LED 2 is currently not used - reserved for future use. </p>"},{"location":"#led-3-sdk-programmable","title":"LED 3 SDK programmable","text":"<p>The LED 3 can be programmed in the SDK to indicate user application states. Please refer to SDK guide for more information. </p>"},{"location":"#led-4-power-delivery-state","title":"LED 4 Power Delivery state","text":"<p><p>LED_4 </p></p> status LED color Description <code>DISCONNECTED</code> BLUE No power supply is connected to USB PD port (Power connector) <code>NO MATCHING PDU</code> YELLOW Power supply is connected but it can not provide the voltage configured with \"SupplyVoltage\" property in configuration file <code>NORMAL</code> GREEN Power supply connected and provides the voltage configured with SupplyVoltage property"},{"location":"#a2b-ports","title":"A2B Ports","text":"<p><p>A2Bridge A2B ports </p></p> <p>For A2B bus communication there are 2 ports available: - A (A2B Master) - This is the port used for communication with previous A2B sub-node(towards main node). Should be used only in the slave mode. - B (A2B Slave) - This port is used for communication with next A2B sub-node(towards next sub-node). Can be used in both Master and Slave modes.</p>"},{"location":"#usb-ports","title":"USB Ports","text":"<p> <p>A2Bridge USB ports </p> There are two USB ports:</p> <ul> <li> <p>Host PC port is used to communicate with Desktop, transmit or receive audio data and for updating A2Bridge firmware</p> </li> <li> <p>Power is used to supply phantom power over A2B. The connected power supply must support the USB Power Delivery (PD) protocol, and the user can configure the requested voltage using configuration file. You will have to use this port only if your A2B bus topology contains A2B bus powered slaves which need more power or higher voltage than can be delivered over Host PC connection. In that case you should connect this connector to the PD capable USB charger. </p> </li> </ul>"},{"location":"#usb-communication","title":"USB Communication","text":"<p>After the device is successfully connected to the host PC it will be presented as 4 USB endpoints: - External audio device - Mass Storage Device - DFU - Device Firmware Update - CDC - Virtual COM port </p> <p></p> <p>External audio device endpoints are used to transmit or receive audio data to/from A2Bridge. Mass Storage Device install in host PC as a small drive, where the configuration json file is present and can be edited.  The CDC - COM port is used for console command </p>"},{"location":"dfu/","title":"Firmware Update","text":"<p>Device firmware can be updated via USB using DFU (Device Firmware Upgrade).</p>"},{"location":"dfu/#dfu-on-windows","title":"DFU on Windows","text":"<p>After the first connection of the A2Bridge, the DFU node will be marked as an unknown device and will miss the driver.</p> <p></p> <p>Windows by default does not support standard DFU class of USB. Driver must be replaced.</p> <p>Replace(install) driver using Zadig: https://zadig.akeo.ie/</p> <p></p>"},{"location":"dfu/#dfu-on-linux","title":"DFU on Linux","text":"<p>Linux supports DFU out of the box, no driver replacement is needed.</p>"},{"location":"dfu/#flashing","title":"Flashing","text":"<p>For DFU flashing use dfu-util tool. Example command:</p> <pre><code>dfu-util.exe --download .\\UA2B\\_cm7.bin.dfu --reset\n</code></pre> <p>NOTE: File with *.dfu extension is a special file prepared during build - it contains metadata for DFU flashing, including information's to which device the update should go.</p> <p>Log of successful updates:</p> <pre><code>Match vendor ID from file: cafe\nMatch product ID from file: 2001\nOpening DFU capable USB device...\nRun-Time device DFU version 0101\nClaiming USB DFU Interface...\nSetting Alternate Interface \\#0 ...\nDetermining device status...\nDFU state(2) = dfuIDLE, status(0) = No error condition is present\nDFU mode device DFU version 0101\nDevice returned transfer size 512\nCopying data from PC to DFU device\nDownload [=========================] 100% 199200 bytes\nDownload done.\nDFU state(7) = dfuMANIFEST, status(0) = No error condition is present\nDFU state(8) = dfuMANIFEST-WAIT-RESET, status(0) = No error condition is\npresent\nResetting USB to switch back to runtime mode\nDone!\n</code></pre>"},{"location":"json/","title":"JSON configuration","text":"<p>The mass storage class USB endpoint is used to pass the needed A2B configuration as a JSON file.  To access it, opens the CONFIG.TXT file. Please be aware that JSON configuration is case sensitive. By default, it contains the following configuration:</p> <pre><code>{\n    \"Version\": \"x.xx\",\n    \"Name\": \"Default\",\n    \"ResetOnNew\": \"True\",\n    \"A2BRole\": \"Master\",\n    \"AudioResolution\": 16,\n    \"UsbInputChannels\": 2,\n    \"UsbOutputChannels\": 2,\n    \"RunInProtobufMode\": \"True\",\n    \"SupplyVoltage\": 5000,\n    \"AudioRouteMatrixDownstream\": [\n      [1],\n      [2],\n    ],\n    \"AudioRouteMatrixUpstream\": [\n      [1],\n      [2],\n    ],\n    \"A2BMasterConfig\" : {\n      \"SlavesOnBus\": 1,\n      \"DnSlots\": 8,\n      \"UpSlots\": 8,\n      \"AutoDiscovery\": \"False\",\n      \"SlaveConfiguration\":[\n        {\n          \"Node\": 0,\n          \"DnSlots\": 0,\n          \"LocalDnSlots\": 8,\n          \"UpSlots\": 0,\n          \"LocalUpSlots\": 8,\n          \"PowerConfig\": \"High\",\n          \"CableLength\": 4,\n          \"ConfigureTDM\": \"True\",\n          \"TdmTxLines\": 1,\n          \"TdmRxLines\": 1,\n          \"TDMMode\": \"TDM8\",\n          \"TDMOptions\": [\"EARLY\", \"INV\", \"ALT\"]\n        }\n      ]\n    },\n    \"A2BSlaveConfig\":\n    {\n      \"TdmRxChannels\": 1,\n      \"TdmTxChannels\": 1\n    }\n}\n</code></pre> <p>To configure the A2Bridge the following options can be changed.</p>"},{"location":"json/#version","title":"Version","text":"<p>The version of the JSON configuration. It needs to be compatible with A2Bridge. The user does not need to change it.  </p>"},{"location":"json/#name","title":"Name","text":"<p>The name of the configuration. Users can change it to save the configuration title.</p>"},{"location":"json/#resetonnew","title":"ResetOnNew","text":"<p>This option is used to configure the behavior on new configuration save. If it is set to True the device will be reset on new configuration uploaded.  </p>"},{"location":"json/#a2brole","title":"A2BRole","text":"<p>Option to configure the A2B role. It can be set to one of these options: \u201cMaster\u201d or \u201cSlave\u201d  </p>"},{"location":"json/#audioresolution","title":"AudioResolution","text":"<p>Audio resolution in bits per sample.  </p>"},{"location":"json/#usbinputchannels","title":"UsbInputChannels","text":"<p>Number of channels that are send to the device from the PC.  </p>"},{"location":"json/#usboutputchannels","title":"UsbOutputChannels","text":"<p>Number of channels that are send to the PC from A2Bridge box.  </p>"},{"location":"json/#runinprotobufmode","title":"RunInProtobufMode","text":"<p>If this option is set, A2Bridge will start automatically in protobuf COM port mode.</p>"},{"location":"json/#supplyvoltage","title":"SupplyVoltage","text":"<p>Voltage in mV requested to supply connected to USB power delivery port. This voltage will be transfered to A2B bus.</p>"},{"location":"json/#audioroutematrixdownstream","title":"AudioRouteMatrixDownstream","text":"<p>Matrix of the channels transmitted to the A2B bus. Each row is an output channel from the USB interface and each element within a row is an A2B output channel to which the corresponding USB channel\u2019s audio will be routed. <pre><code>\"AudioRouteMatrixDownstream\": [\n    [A2B Channel, A2B Channel \u2026], - Channel 1 coming from USB\n    [A2B Channel, A2B Channel \u2026], - Channel 2 coming from USB\n    \u2026\n],\n</code></pre></p> <p>As an example we will create the configuration in which there will be 3 USB input channels and 10 A2B output channels. We want to forward 1st USB channel to A2B channels: 1,2,3,4,5,6. 2nd USB channel will be forwarded to 7,8 A2B channels and the last 3rd channels will be forwarded to 9th A2B channel.</p> <pre><code>\"AudioRouteMatrixDownstream\": [\n    [1, 2, 3, 4, 5, 6], - USB Channel 1 -&gt; A2B Channels 1,2,3,4,5,6\n    [7, 8], - USB Channel 2 -&gt; A2B Channels 7,8\n    [9] - USB Channel 3 -&gt; A2B Channel 9\n]\n</code></pre>"},{"location":"json/#audioroutematrixupstream","title":"AudioRouteMatrixUpstream","text":"<p>Matrix of the channels received from A2B bus and transmitted to USB bus. Each row represents A2B channel received from the bus and each element within a row is an USB output channel number.</p> <p>!!! info Attention:</p> <pre><code>It works opposite to AudioRouteMatrixDownstream.\n</code></pre>"},{"location":"json/#a2bmasterconfig","title":"A2BMasterConfig","text":"<p>Contains the configuration used when the device is set to \u201cMaster\u201d mode.  </p>"},{"location":"json/#slavesonbus","title":"SlavesOnBus","text":"<p>Number of slaves available on A2B bus.  </p>"},{"location":"json/#dnslots","title":"DnSlots","text":"<p>Number of down slots going out from the device.  </p>"},{"location":"json/#upslots","title":"UpSlots","text":"<p>Number of the up slots coming to the device.  </p>"},{"location":"json/#autodiscovery","title":"AutoDiscovery","text":"<p>Setting this flag to true will cause the A2B discovery to be triggered every 500ms as long as the A2Bridge doesn't reach the Normal state (A2B discovery successful)</p>"},{"location":"json/#slaveconfiguration","title":"SlaveConfiguration","text":"<p>Contains the table of the slave configurations. Each slave configuration should contain following properties:</p>"},{"location":"json/#node","title":"Node","text":"<p>Node number. The order of the node counting from 0</p>"},{"location":"json/#dnslots_1","title":"DnSlots","text":"<p>Number of channels forwarded downward.</p>"},{"location":"json/#localdnslots","title":"LocalDnSlots","text":"<p>Number of the slots coming from the upper-node consumed by the current node.</p>"},{"location":"json/#upslots_1","title":"UpSlots","text":"<p>Number of slots forwarded upward.</p>"},{"location":"json/#localupslots","title":"LocalUpSlots","text":"<p>Number of slots produced by current node. The number of slots send up to the upper node (to master direction) is equal to UpSlots + LocalUpSlots</p>"},{"location":"json/#powerconfig","title":"PowerConfig","text":"<p>Power configuration. Can be set to one of those values: High or Low</p>"},{"location":"json/#cablelength","title":"CableLength","text":"<p>Length of the cable to the upper node.</p>"},{"location":"json/#configuretdm","title":"ConfigureTDM","text":"<p>If this option is set the slave TDM configuration will be set by A2Bridge. Can be set to False if the node is configured by itself.</p>"},{"location":"json/#tdmtxlines","title":"TdmTxLines","text":"<p>Number of TDM TX lines coming from the node (from A2B transceiver to the slave \u00b5C)</p>"},{"location":"json/#tdmrxlines","title":"TdmRxLines","text":"<p>Number of TDM RX lines coming to the node (from slave \u00b5C to slave A2B transceiver)</p>"},{"location":"json/#tdmmode","title":"TDMMode","text":"<p>TDM mode. Should be set to the one of the following values: TDM2, TDM4, TDM8, TDM12, TDM16, TDM20, TDM24, TDM32.  TDMx is a property which describes the number of channels in one TDM frame.</p>"},{"location":"json/#tdmoptions","title":"TDMOptions","text":"<p>Additional TDM configuration. This is the table of flags used for TDM communication.</p>"},{"location":"json/#early","title":"EARLY","text":"<p>SYNC pin changes one cycle before the MSB of data channel 0</p>"},{"location":"json/#alt","title":"ALT","text":"<p>When not set SYNC pin is active for one BCLK cycle at the start of each sampling period, otherwise SYNC is active for 50% of sampling period</p> <p></p>"},{"location":"json/#inv","title":"INV","text":"<p>Invert Sync signal. When set falling edge of sync references the first channel otherwise it is rising edge.</p>"},{"location":"json/#rxbclkinv","title":"RXBCLKINV","text":"<p>When this flag is set DRX signal is sampled on falling   edge of BCLK.</p>"},{"location":"json/#txbclkinv","title":"TXBCLKINV","text":"<p>When this flag is set DTX pin is changed on the falling edge of BCLK.</p>"},{"location":"json/#tdmss","title":"TDMSS","text":"<p>when this flag is set the slaves TDM slot length is 16 bits; 32 bits otherwise</p>"},{"location":"json/#interleave","title":"INTERLEAVE","text":"<p>When this option is set, the channels are interleaved between TDM lines.</p> <p></p>"},{"location":"json/#a2bslaveconfig","title":"A2BSlaveConfig","text":"<p>contains the following options used when A2BRole set to Slave:</p>"},{"location":"json/#tdmrxchannels","title":"TdmRxChannels","text":"<p>Number of TDM RX channels (from A2B transceiver to slave \u00b5C)</p>"},{"location":"json/#tdmtxchannels","title":"TdmTxChannels","text":"<p>Number of TDM TX channels (from slave \u00b5C to A2B transceiver)</p>"},{"location":"serial/","title":"Serial COM port communication","text":""},{"location":"serial/#human-readable-console","title":"Human readable console","text":"<p>After connecting to Host PC the A2Bridge will register in your PC a virtual COM port which can be used as a regular serial port for communicating with the A2Bridge over command line or python library. Since it is USB virtual COM port the baud rate can be set to any value. </p> <p>Under Windows OS you can find the number of the COM port in the device manager.  As a tool to work with the A2Bridge we suggest teraterm since, opposite to PuTTY, it doesn't request restarting the session every time the new configuration of the Bridge will be stored and the device restarts. </p> <p>Under linux OS, you can find the corresponding serial port under <code>/dev/ttyACMx</code>. You can use </p> <p></p> <p>There are few commands available on COM console depending on the A2B mode configured.</p>"},{"location":"serial/#console-commands-in-a2b-master-mode","title":"Console commands in A2B Master mode.","text":"<p>Following console commands are available in Master mode:</p>"},{"location":"serial/#help","title":"help","text":"<p>Prints all available command's help. </p>"},{"location":"serial/#reset","title":"reset","text":"<p>Resets the device. Invoking this command will cause the device to get disconnected from Host PC and reconnected after a while. </p>"},{"location":"serial/#info","title":"info","text":"<p>Prints the information about the device <pre><code>A2Bridge:~$ info\nHardware revision: 1\nSoftware version: v3.0.2-3-g0f3fe09-dirty\nSerial number: 000000030\nChip used: AD2435\nRESULT: OK\nA2Bridge:~$\n</code></pre></p>"},{"location":"serial/#status","title":"status","text":"<p>Prints the status of the device. Contains the information about the number of slaves discovered and current A2B status. <pre><code>A2Bridge:~$ status\nDevice status:\n        Device state: Impaired\n        USB downstream: Idle\n        USB upstream: Idle\n        Config \"Default\" JSON: valid\n        A2B Cable diagnostic: No fault detected\n        Power Delivery: disconnected\n        A2B slaves discovered: 0\n        A2B status: Fault - timeout, at slave: 0\nRESULT: OK\nA2Bridge:~$ \n</code></pre> The <code>Device state</code> can have following values: - <code>Imparied</code> not all slaves configured to be present on the bus have been discovered  - <code>Normal</code> all configured slaves have been discovered and connected, ready to play audio ove A2B  - <code>Error</code> the device detected either configuration, A2B bus or internal error and must be restarted </p> <p>The <code>USB downstream</code> &amp; <code>USB upstream</code> can have values: - <code>Idle</code> the host is not streaming audio data over the USB  - <code>Streaming</code> the host is streaming data over the USB </p>"},{"location":"serial/#resetjson","title":"resetjson","text":"<p>resets the CONFIG.TXT Json file to default one.</p>"},{"location":"serial/#discover","title":"discover","text":"<p>Triggers the A2B bus discovery process</p>"},{"location":"serial/#switchproto","title":"switchproto","text":"<p>Switches COM port to protobuf mode. !!! info Attention:     After calling this command you will be not able to use command line until reset of the device (assuming the corresponding configuration is set to command line - see RunInProtobufMode)</p>"},{"location":"serial/#loglevel","title":"loglevel","text":"<p>Changes the log level. Must to be set to one of these values - \"off\", \"debug, \"info\", \"warning\", \"error\". You can change the log level also using the configuration file. Changes done over command line will be not stored in the device. After restart the log level will be reset to the level configured in the config file. </p>"},{"location":"serial/#regs","title":"regs","text":"<p>Prints the A2B transceiver registers and its values. If the number of subnode is provided (in master mode) then prints the register values from the subnode transceiver. Usage:  <pre><code>A2Bridge:~$ regs\n...\nA2Bridge:~$ regs 0\n</code></pre></p>"},{"location":"serial/#console-commands-in-a2b-slave-mode","title":"Console commands in A2B Slave mode.","text":"<p>Following console commands are available in Slave mode:</p>"},{"location":"serial/#reset_1","title":"reset","text":"<p>Resets the device</p>"},{"location":"serial/#info_1","title":"info","text":"<p>Prints the information about the device</p>"},{"location":"serial/#status_1","title":"status","text":"<p>Prints the status of the device.</p>"},{"location":"serial/#resetjson_1","title":"resetjson","text":"<p>Resets the CONFIG.TXT Json file to default one.</p>"},{"location":"serial/#switchproto_1","title":"switchproto","text":"<p>Switches COM port to protobuf mode</p>"},{"location":"serial/#protobuf-mode","title":"Protobuf mode","text":"<p>Device can be switch to use the binary communication over protobuf protocol. In that case the ready to use python library available under: XAudio Lib</p>"},{"location":"serial/#reset_2","title":"Reset","text":"<p>Resets the device</p>"},{"location":"serial/#message-properties","title":"Message properties","text":"<p>None</p>"},{"location":"serial/#response","title":"Response","text":"<p>Positive or negative response.</p>"},{"location":"serial/#status_2","title":"Status","text":"<p>Sends the response with current status of the device depending on the A2B Role</p>"},{"location":"serial/#message-properties_1","title":"Message properties","text":"<p>None</p>"},{"location":"serial/#response_1","title":"Response","text":"<p>Common for slave and Master mode:</p> <p>usb_audio_downstream_state - Enumerate with current downstream USB state. Contains one of the following values:</p> <pre><code>    USB_AUDIO_STREAM_STATE_UNSPECIFIED = 0;\n    USB_AUDIO_STREAM_STATE_IDLE = 1;\n    USB_AUDIO_STREAM_STATE_STREAMING = 2;\n</code></pre> <p>usb_audio_upstream_state - Enumerate with current upstream audio USB state. </p> <pre><code>  USB_AUDIO_STREAM_STATE_UNSPECIFIED = 0;\n  USB_AUDIO_STREAM_STATE_IDLE = 1;\n  USB_AUDIO_STREAM_STATE_STREAMING = 2;\n</code></pre> <p>device_state - enumerate with current device status</p> <p><pre><code>  DEVICE_STATE_UNSPECIFIED = 0;\n  DEVICE_STATE_BOOT = 1;\n  DEVICE_STATE_NORMAL = 2;\n  DEVICE_STATE_IMPAIRED = 3;\n  DEVICE_STATE_ERROR = 4;\n</code></pre> config_json_state - enumerate with current json config status</p> <pre><code>  CONFIG_JSON_STATE_UNSPECIFIED = 0;\n  CONFIG_JSON_STATE_VALID = 1;\n  CONFIG_JSON_STATE_INVALID = 2;\n</code></pre> <p>Master:</p> <p>A2bFault - (optional) Structure containing the information about existing fault in A2B transceiver. This message has following properties:</p> <p>fault - enumerate with current fault type on A2B transceiver</p> <pre><code>  LIBAD243X_FAULTTYPE_NONE = 0,\n  LIBAD243X_FAULTTYPE_BECOVF = 1,\n  LIBAD243X_FAULTTYPE_SRF_MISS = 2,\n  LIBAD243X_FAULTTYPE_PWR_SHRT2GND = 3,\n  LIBAD243X_FAULTTYPE_PWR_SHRT2VBAT = 4,\n  LIBAD243X_FAULTTYPE_PWR_SHRT2GTHR = 5,\n  LIBAD243X_FAULTTYPE_PWR_OPEN = 6,\n  LIBAD243X_FAULTTYPE_PWR_REVERSE = 7,\n  LIBAD243X_FAULTTYPE_PWR_OTHER = 8,\n  LIBAD243X_FAULTTYPE_PWR_NL_SHRT2GND = 9,\n  LIBAD243X_FAULTTYPE_PWR_NL_SHRT2VBAT = 10,\n  LIBAD243X_FAULTTYPE_TIMEOUT = 11,\n  LIBAD243X_FAULTTYPE_MSTR_RESET = 12,\n  LIBAD243X_FAULTTYPE_OTHER = 13,\n</code></pre> <p>location - enumerate containing the location of fault source</p> <p><pre><code>LIBAD243X_FAULTSOURCE_MASTER = 0,\nLIBAD243X_FAULTSOURCE_SLAVE = 1,\n</code></pre> slave_with_fault - (optional) If the fault source is slave contains the slave index.</p> <p>a2b_slaves_discovered - number of slaves discovered</p> <p>Slave:</p> <p>a2b_state - A2B slave state</p> <p>SLAVE_A2B_STATE_UNSPECIFIED = 0;   SLAVE_A2B_STATE_INIT = 1;   SLAVE_A2B_STATE_WAIT_DISCOVER = 2;   SLAVE_A2B_STATE_READY = 3;   SLAVE_A2B_STATE_NOT_READY = 4; Info - Request information about the device Message properties: None Response:</p> <p>hardware_revision - Hardware revision number</p> <p>software_revision - String with software revision</p> <p>serial_number - String with serial number</p>"},{"location":"serial/#a2bdiscoveryrequest","title":"A2BDiscoveryRequest","text":"<p>Request A2B bus slave re-discovery</p>"},{"location":"serial/#message-properties_2","title":"Message properties","text":"<p>None</p>"},{"location":"serial/#response_2","title":"Response","text":"<p>Positive or negative</p>"},{"location":"serial/#i2coverdistance","title":"I2cOverDistance","text":"<p>Send I2C command over A2B bus to one of the slaves or its peripheral.</p>"},{"location":"serial/#message-properties_3","title":"Message properties","text":"<p>I2cOverDistanceAccessType - Access type enumerate:</p> <p><pre><code>  I2C_OVER_DISTANCE_UNSPECIFIED = 0;\n  I2C_OVER_DISTANCE_WRITE = 1;\n  I2C_OVER_DISTANCE_READ = 2;\n</code></pre> peripheral_i2c_addr  - (optional) if this property is set I2C message will be forwarded to slaves perihperal.</p> <p>node - the index of the node to which the message will be sent or read.</p> <p>Data - Data to send or read </p> <p>reg - Register to read/write</p> <p>value - Value to write in case of I2C_OVER_DISTANCE_WRITE access type</p>"},{"location":"serial/#response_3","title":"Response:","text":"<p>access_type - Access type enumerate:</p> <p>I2C_OVER_DISTANCE_UNSPECIFIED = 0;   I2C_OVER_DISTANCE_WRITE = 1;   I2C_OVER_DISTANCE_READ = 2; value - the value read from the register</p>"},{"location":"serial/#a2bmailboxtransfer","title":"A2BMailboxTransfer","text":"<p>Request to read/write A2B mailbox.</p>"},{"location":"serial/#message-properties_4","title":"Message properties","text":"<p>mailbox_id - Mailbox identifier</p> <p>access_type - Access type enumerate:</p> <p><pre><code>  A2B_MAILBOX_ACCESS_TYPE_UNSPECIFIED = 0;\n  A2B_MAILBOX_ACCESS_TYPE_WRITE = 1;\n  A2B_MAILBOX_ACCESS_TYPE_READ = 2;\n</code></pre> node - node identifier to which the message will be sent/read.</p> <p>bytes - length of the mailbox message (has to be lower than 4 bytes)</p>"},{"location":"serial/#response_4","title":"Response","text":"<p>mailbox_id - Mailbox identifier</p> <p>access_type - Access type enumerate:</p> <p><pre><code>  A2B_MAILBOX_ACCESS_TYPE_UNSPECIFIED = 0;\n  A2B_MAILBOX_ACCESS_TYPE_WRITE = 1;\n  A2B_MAILBOX_ACCESS_TYPE_READ = 2;\n</code></pre> access_status - Status of the read/write to mailbox.</p> <p><pre><code>  A2B_MAILBOX_STATUS_UNSPECIFIED = 0;\n  A2B_MAILBOX_STATUS_OK = 1;\n  A2B_MAILBOX_STATUS_GENERAL_FAIL = 2;\n  A2B_MAILBOX_STATUS_NOT_EMPTY = 3;\n  A2B_MAILBOX_STATUS_NOT_FULL = 4;\n</code></pre> data - data read from the mailbox </p>"},{"location":"setup/","title":"Setup","text":""},{"location":"setup/#windows-setup","title":"Windows setup","text":"<p>You do not have to make any pre-installation when your Host PC uses Windows OS. It's enough to just plug the A2Bridge to any free USB connector using delivered USB cable. </p> <p>But by default, Windows OS cannot transmit more than 2 audio channels to or from the USB audio devices. To use more than 2 audio channels, additional drivers need to be installed (Check Download \u2013 ASIO4ALL Official Home). After installation of additional drivers, it can be used in programs like Audacity or ocenaudio.</p> <p>Attention:</p> <p>A2Bridge can be used either with Python and WDM-KS drivers (preferred option) using libraries such as sounddevice, or with ASIO-based applications.</p>"},{"location":"setup/#linux-setup","title":"Linux setup","text":"<p>Linux can handle multiple audio channels natively without requiring any additional drivers.</p>"},{"location":"setup/#a2bridge-as-a-master","title":"A2Bridge as a master","text":"<p>This guide prepares a test configuration that transmits 8 downstream channels and receives 4 upstream channels using 32-bit audio resolution. The slave device must be powered using 12 V phantom power.</p> <p>Connect the A2Bridge as shown in the provided example diagram. Phantom power is delivered using a USB charger.  <p>Master Configuration example with phantom power delivered by USB charger </p></p> <p>Once connected to the PC, the A2Bridge appears as a mass storage device. Open this device and edit the CONFIG.TXT file.  <p>A2Bridge as a mass storage device in Windows </p></p> <pre><code>{\n    \"Version\": \"1.31\",\n    \"Name\": \"Default\",\n    \"ResetOnNew\": \"True\",\n    \"A2BRole\": \"Master\",\n    \"AudioResolution\": 16,\n    \"UsbInputChannels\": 2,\n    \"UsbOutputChannels\": 2,\n    \"RunInProtobufMode\": \"False\",\n    \"SupplyVoltage\": 5000,\n    \"AudioRouteMatrixDownstream\": [\n      [1],\n      [2],\n    ],\n    \"AudioRouteMatrixUpstream\": [\n      [1],\n      [2],\n    ],\n    \"A2BMasterConfig\" : {\n      \"SlavesOnBus\": 1,\n      \"DnSlots\": 8,\n      \"UpSlots\": 8,\n      \"SlaveConfiguration\":[\n        {\n          \"Node\": 0,\n          \"DnSlots\": 0,\n          \"LocalDnSlots\": 8,\n          \"UpSlots\": 0,\n          \"LocalUpSlots\": 8,\n          \"PowerConfig\": \"High\",\n          \"CableLength\": 4,\n          \"ConfigureTDM\": \"True\",\n          \"TdmTxLines\": 1,\n          \"TdmRxLines\": 1,\n          \"TDMMode\": \"TDM8\",\n          \"TDMOptions\": [\"EARLY\", \"INV\", \"ALT\"]\n        }\n      ]\n    },\n    \"A2BSlaveConfig\":\n    {\n      \"TdmRxChannels\": 1,\n      \"TdmTxChannels\": 1\n    }\n}\n</code></pre> <p>The configuration file needs to be modified according to our needs. The first thing that we need to check is the A2BRole parameter. <pre><code>    \"A2BRole\": \"Master\",\n</code></pre> As it is by default set to Master we don't need to change it.</p> <p>The next thing we need to check is the audio configuration and number of channels  <pre><code>    \"AudioResolution\": 16,\n    \"UsbInputChannels\": 2,\n    \"UsbOutputChannels\": 2,\n</code></pre> It needs to be changed to  <pre><code>    \"AudioResolution\": 32,\n    \"UsbInputChannels\": 8,\n    \"UsbOutputChannels\": 4,\n</code></pre> as audio resolution we need is 32 bit and we are going to transmit 8 channels down and receive 4 channels from slave.  The SupplyVoltage has to be configured to 12000 (value in mV) as we need 12V phantom power.</p> <p>Please remember that not all of the USB PD chargers support 12V. To verify if your charger does please read the rating plate of your USB charger.  <p>USB charger supporting 12V</p></p> <p>The next we are going to prepare audio routing matrices. We are going to transmit each USB channel to corresponding A2B channels so the matrix is going to be simple. <pre><code>    \"AudioRouteMatrixDownstream\": [\n      [1],\n      [2],\n      [3],\n      [4],\n      [5],\n      [6],\n      [7],\n      [8]\n    ],\n    \"AudioRouteMatrixUpstream\": [\n      [1],\n      [2],\n      [3],\n      [4],\n    ],\n</code></pre> <p>Routing matrix visualization</p></p> <p>Next the A2B bus and slaves need to be configured.</p> <pre><code>    \"A2BMasterConfig\" : {\n      \"SlavesOnBus\": 1, &lt;- There is one slave on our bus\n      \"DnSlots\": 8,  &lt;- 8 channels downstreamed\n      \"UpSlots\": 4, &lt;- 4 channels upstreamed to usb\n      \"SlaveConfiguration\":[\n        {\n          \"Node\": 0, // &lt;- Node number starting from 0\n          \"DnSlots\": 0, // &lt;- Number of channels send down\n          \"LocalDnSlots\": 8, // &lt;- Number of channels consumed by node\n          \"UpSlots\": 0, &lt;- Number of channels forwarded from down to up\n          \"LocalUpSlots\": 4, &lt;- number of channels produced by the node\n          \"PowerConfig\": \"Low\",\n          \"CableLength\": 4,\n          \"ConfigureTDM\": \"True\",\n          \"TdmTxLines\": 1,\n          \"TdmRxLines\": 1,\n          \"TDMMode\": \"TDM8\",\n          \"TDMOptions\": [\"EARLY\", \"INV\", \"ALT\"]\n        }\n      ]\n    }\n</code></pre> <p>So in the end we have following configuration</p> <pre><code>{\n    \"Version\": \"1.31\",\n    \"Name\": \"Default\",\n    \"ResetOnNew\": \"True\",\n    \"A2BRole\": \"Master\",\n    \"AudioResolution\": 32,\n    \"UsbInputChannels\": 8,\n    \"UsbOutputChannels\": 4,\n    \"RunInProtobufMode\": \"False\",\n    \"SupplyVoltage\": 12000,\n    \"AudioRouteMatrixDownstream\": [\n      [1],\n      [2],\n      [3],\n      [4],\n      [5],\n      [6],\n      [7],\n      [8]\n    ],\n    \"AudioRouteMatrixUpstream\": [\n      [1],\n      [2],\n      [3],\n      [4],\n    ],\n    \"A2BMasterConfig\" : {\n      \"SlavesOnBus\": 1,\n      \"DnSlots\": 8,\n      \"UpSlots\": 4,\n      \"SlaveConfiguration\":[\n        {\n          \"Node\": 0,\n          \"DnSlots\": 0,\n          \"LocalDnSlots\": 8,\n          \"UpSlots\": 0,\n          \"LocalUpSlots\": 4,\n          \"PowerConfig\": \"High\",\n          \"CableLength\": 4,\n          \"ConfigureTDM\": \"True\",\n          \"TdmTxLines\": 1,\n          \"TdmRxLines\": 1,\n          \"TDMMode\": \"TDM8\",\n          \"TDMOptions\": [\"EARLY\", \"INV\", \"ALT\"]\n        }\n      ]\n    },\n    \"A2BSlaveConfig\":\n    {\n      \"TdmRxChannels\": 1,\n      \"TdmTxChannels\": 1\n    }\n}\n</code></pre> <p>As the new configuration has been saved the A2Bridge should restart and start the new discovery according to our configuration. Please check if LED_1 (see the home page) is green which means that A2Bridge succesfully discovered all configured slave and no errors occured. LED_4 Should also be green. If it's yellow then it means that your charger does not support 12V. </p> <p> <p>A2Bridge in operable state with external power supply attached</p></p> <p>When the device is connected we can check it's status with virtual com port console. Any Serial port terminal will work, in our example we will use PuTTy.</p> <p> <p>PuTTy configuration to open A2Bridge console.</p></p> <p>Bandwidth</p> <p>Since A2Bridge Serial port is virtual the entered bandwidth does not matter and it can be set to anything.</p> <p>To read the A2Bridge status we use status command. </p> A2Bridge discovered all of the nodes successfullyDiscovery failed <p> <p>A2Bridge status with all of the nodes discovered.</p></p> <p> <p>A2Bridge status. Undiscovered nodes.</p></p> <p>Troubleshooting</p> <p>In case of missing node please check the cable connection.</p> <p>Now we can transmit the data. In our example we will use python script to transmit the sine wave. I configured the subnode to loopback channels 1 -&gt; 1, 3 -&gt; 2, 5 -&gt; 3, 7 -&gt; 4. </p>"},{"location":"setup/#audio-produced-with-python-script","title":"Audio produced with python script","text":"<p>To transmit the data we use sounddevice library (The audio can also be transmitted with ASIO4ALL and programs like Audacity or ocenaudio). The code below generates the sine wave and fullfills the audio buffer in callbacks.</p> <p>Please see the play script to find python code. The record script can be used to record the upstream.</p> <p>Once the audio is recorded the plot should show the sine wave like in the image below.</p> <p> <p>PyPlot output.</p></p>"},{"location":"setup/#audio-produced-with-ocenaudio","title":"Audio produced with ocenaudio","text":"<p>The second option to handle multi-channel configuration is to use ocenaudio with ASIO4ALL host API. Install both of these programs and start the ocenaudio. Configure the output Device by following the image below.  <p>Ocenaudio config.</p></p> <p>Then configure the ASIO4ALL.  <p>ASIO4ALL icon in windows menu.</p></p> <p>Please check if all of the other devices are disabled and enable the \"XAudio A2B Interface\" only  <p>Configuration of Asio4ALL.</p></p> <p>Then we can go back to ocenaudio and generate the channels content that we want to play. </p> <p> <p>Ocenaudio generate tone menu.</p> <p>Ocenaudio generate channels content.</p> Once you create the audio output you can start playing the audio using A2Bridge.   <p>Play generated sine wave.</p></p> <p>The status command should inform about streaming in USB downstream.</p> <p> <p>Status USB streaming</p></p>"}]}